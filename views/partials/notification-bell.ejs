<div class="notification-wrapper">
    <button class="notif-btn" id="notifBtn" type="button" onclick="window.toggleNotifications ? window.toggleNotifications(event) : console.error('Main.js não carregado')">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
        </svg>
        <% if (locals.unreadCount > 0) { %>
            <span class="notif-badge"><%= unreadCount > 9 ? '9+' : unreadCount %></span>
        <% } %>
    </button>

    <div class="notif-dropdown" id="notifDropdown">
        <div class="notif-header">
            <span>Notificações</span>
            <button class="mark-all-btn" type="button" onclick="markAllRead()">Marcar lidas</button>
        </div>
        <div class="notif-list">
            <% if (locals.notifications && locals.notifications.length > 0) { %>
                <% notifications.forEach(n => { %>
                    <div class="notif-item <%= n.is_read ? 'read' : 'unread' %>" onclick="clickNotification('<%= n.id %>', '<%= n.link %>')">
                        <div class="notif-title"><%= n.title %></div>
                        <div class="notif-msg"><%= n.message %></div>
                        <div class="notif-time"><%= new Date(n.created_at).toLocaleDateString('pt-BR') %></div>
                    </div>
                <% }) %>
            <% } else { %>
                <div class="notif-empty">Nenhuma notificação recente.</div>
            <% } %>
        </div>
        <a href="#" class="notif-footer">Ver todas</a>
    </div>
</div>

<script>
    // Fallback de segurança caso o main.js não carregue a tempo
    if (!window.toggleNotifications) {
        window.toggleNotifications = function(e) {
            e.stopPropagation();
            const dropdown = document.getElementById('notifDropdown');
            if(dropdown) dropdown.classList.toggle('active');
        }
    }
</script>
