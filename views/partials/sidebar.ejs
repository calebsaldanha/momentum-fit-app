<style>
    /* Estilo do Cabeçalho Mobile embutido na Sidebar */
    .mobile-dash-header-embedded {
        display: none; /* Escondido no desktop */
        align-items: center;
        justify-content: space-between;
        padding: 15px 20px;
        background: #111;
        border-bottom: 1px solid var(--border-light);
        margin-bottom: 20px;
        width: 100%;
    }

    @media (max-width: 992px) {
        .mobile-dash-header-embedded {
            display: flex; /* Visível no mobile */
        }
        /* Ajuste para garantir que a sidebar funcione como overlay */
        .sidebar {
            position: fixed;
            top: 0;
            left: -100%;
            height: 100vh;
            z-index: 9999;
            transition: left 0.3s ease;
        }
        .sidebar.active {
            left: 0;
        }
    }
</style>

<div id="mobile-header-source" style="display:none;">
    <div class="mobile-dash-header-embedded">
        <button onclick="document.querySelector('.sidebar').classList.add('active')" class="btn btn-outline btn-sm">
            <i class="fas fa-bars"></i> Menu
        </button>
        <span style="font-weight: 600; color: #ccc;">
            <% if (path.includes('client')) { %> Área do Aluno <% } %>
            <% if (path.includes('trainer')) { %> Área do Treinador <% } %>
            <% if (path.includes('admin')) { %> Admin <% } %>
        </span>
    </div>
</div>

<aside class="sidebar">
    <div class="sidebar-header">
        <div style="display: flex; justify-content: space-between; width: 100%; align-items: center;">
            <span style="font-weight: 800; font-size: 1.2rem; color: var(--primary-color);">Momentum</span>
            <button onclick="document.querySelector('.sidebar').classList.remove('active')" class="mobile-only" style="background:none; border:none; color:white; font-size:1.5rem;">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <nav class="sidebar-nav">
        <% if (user.role === 'client') { %>
            <div class="menu-category">TREINO</div>
            <a href="/client/dashboard" class="nav-item <%= path === '/client/dashboard' ? 'active' : '' %>">
                <i class="fas fa-home"></i> Dashboard
            </a>
            <a href="/client/workouts" class="nav-item <%= path === '/client/workouts' ? 'active' : '' %>">
                <i class="fas fa-dumbbell"></i> Meus Treinos
            </a>
            <a href="/client/evolution" class="nav-item <%= path === '/client/evolution' ? 'active' : '' %>">
                <i class="fas fa-chart-line"></i> Evolução
            </a>

            <div class="menu-category">CONTA</div>
            <a href="/client/profile" class="nav-item <%= path === '/client/profile' ? 'active' : '' %>">
                <i class="fas fa-user-edit"></i> Anamnese
            </a>
            <a href="/client/financial" class="nav-item <%= path === '/client/financial' ? 'active' : '' %>">
                <i class="fas fa-wallet"></i> Financeiro
            </a>
             <a href="/client/ai-coach" class="nav-item <%= path === '/client/ai-coach' ? 'active' : '' %>">
                <i class="fas fa-robot"></i> IA Coach
            </a>
        <% } %>

        <% if (user.role === 'trainer') { %>
            <div class="menu-category">GESTÃO</div>
            <a href="/trainer/dashboard" class="nav-item <%= path === '/trainer/dashboard' ? 'active' : '' %>">
                <i class="fas fa-tachometer-alt"></i> Visão Geral
            </a>
            <a href="/trainer/clients" class="nav-item <%= path === '/trainer/clients' ? 'active' : '' %>">
                <i class="fas fa-users"></i> Alunos
            </a>
             <a href="/trainer/library" class="nav-item <%= path === '/trainer/library' ? 'active' : '' %>">
                <i class="fas fa-book"></i> Biblioteca
            </a>
            <div class="menu-category">CONTEÚDO</div>
            <a href="/trainer/content" class="nav-item <%= path === '/trainer/content' ? 'active' : '' %>">
                <i class="fas fa-pen-nib"></i> Artigos
            </a>
            <a href="/trainer/financial" class="nav-item <%= path === '/trainer/financial' ? 'active' : '' %>">
                <i class="fas fa-dollar-sign"></i> Extrato
            </a>
        <% } %>

        <% if (user.role === 'admin' || user.role === 'superadmin') { %>
            <div class="menu-category">ADMINISTRAÇÃO</div>
            <a href="/admin/dashboard" class="nav-item <%= path === '/admin/dashboard' ? 'active' : '' %>">
                <i class="fas fa-chart-pie"></i> Dashboard
            </a>
            <a href="/admin/users" class="nav-item <%= path === '/admin/users' ? 'active' : '' %>">
                <i class="fas fa-users-cog"></i> Usuários
            </a>
            <a href="/admin/approvals" class="nav-item <%= path === '/admin/approvals' ? 'active' : '' %>">
                <i class="fas fa-check-double"></i> Aprovações
            </a>
            <div class="menu-category">SISTEMA</div>
            <a href="/admin/finance" class="nav-item <%= path === '/admin/finance' ? 'active' : '' %>">
                <i class="fas fa-coins"></i> Financeiro
            </a>
            <a href="/admin/content" class="nav-item <%= path === '/admin/content' ? 'active' : '' %>">
                <i class="fas fa-newspaper"></i> Conteúdo
            </a>
            <a href="/admin/ia-audit" class="nav-item <%= path === '/admin/ia-audit' ? 'active' : '' %>">
                <i class="fas fa-microchip"></i> Auditoria IA
            </a>
        <% } %>

        <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border-light);">
            <a href="/chat" class="nav-item <%= path === '/chat' ? 'active' : '' %>">
                <i class="fas fa-comments"></i> Chat
            </a>
            <a href="/auth/logout" class="nav-item logout" style="color: #ff6b6b;">
                <i class="fas fa-sign-out-alt"></i> Sair
            </a>
        </div>
    </nav>
</aside>

<script>
    // Script para injetar o header mobile automaticamente no início do Main
    document.addEventListener("DOMContentLoaded", function() {
        if (window.innerWidth <= 992) {
            const main = document.querySelector('main');
            const headerSource = document.getElementById('mobile-header-source');
            if (main && headerSource) {
                // Insere o header mobile como primeiro elemento do main
                main.insertAdjacentHTML('afterbegin', headerSource.innerHTML);
            }
        }
    });
</script>
