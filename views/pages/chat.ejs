<%- include('../partials/header') %>

<div class="page-content-wrapper" style="height: calc(100vh - 140px); display: flex; flex-direction: column;">
    <div class="card-modern" style="flex: 1; display: flex; flex-direction: column; overflow: hidden; padding: 0;">
        
        <div class="chat-header" style="padding: 1.5rem; border-bottom: 1px solid var(--border); background: var(--bg-card);">
            <h2 class="text-neon" style="margin: 0; font-size: 1.2rem;">
                <i class="fas fa-comments"></i> Chat com Treinador
            </h2>
            <p class="text-muted" style="margin: 5px 0 0 0; font-size: 0.9rem;">Tire d√∫vidas e envie feedback sobre seus treinos.</p>
        </div>

        <div id="chat-messages" style="flex: 1; overflow-y: auto; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem;">
            <% if (typeof messages !== 'undefined' && messages.length > 0) { %>
                <% messages.forEach(msg => { %>
                    <div style="background: var(--bg-hover); padding: 1rem; border-radius: 8px; max-width: 80%; align-self: <%= msg.senderId === user.id ? 'flex-end' : 'flex-start' %>;">
                        <strong><%= msg.senderName %>:</strong>
                        <p style="margin: 0.5rem 0 0 0; color: var(--text-main);"><%= msg.content %></p>
                    </div>
                <% }) %>
            <% } else { %>
                <div style="text-align: center; color: var(--text-muted); margin-top: 2rem;">
                    <i class="fas fa-comment-dots" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                    <p>Nenhuma mensagem ainda. Comece a conversa!</p>
                </div>
            <% } %>
        </div>

        <div class="chat-input-area" style="padding: 1.5rem; border-top: 1px solid var(--border); background: var(--bg-card);">
            <form action="/chat/send" method="POST" style="display: flex; gap: 10px;">
                <input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
                <input type="text" name="message" class="form-input" placeholder="Digite sua mensagem..." required style="flex: 1;">
                <button type="submit" class="btn btn-primary" style="width: auto; padding: 0 1.5rem;">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </form>
        </div>

    </div>
</div>

<%- include('../partials/footer') %>
