<%- include('../partials/header.ejs', { title: 'Chat', currentPage: 'chat' }) %>
<div class="dashboard-container">
    <%- include('../partials/sidebar.ejs', { currentPage: 'chat' }) %>

    <main class="dashboard-main" style="display: flex; flex-direction: column;">
        <div class="page-header" style="margin-bottom: 1rem;">
            <h1 class="page-title">Mensagens</h1>
        </div>

        <div class="chat-container">
            <div id="chat-messages" class="chat-messages">
                <% if (typeof messages !== 'undefined' && messages.length > 0) { %>
                    <% messages.forEach(msg => { %>
                        <div class="message-bubble <%= msg.sender_id === user.id ? 'message-sent' : 'message-received' %>">
                            <div><%= msg.content %></div>
                            <div style="font-size: 0.7rem; opacity: 0.6; margin-top: 5px; text-align: right;">
                                <%= new Date(msg.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) %>
                            </div>
                        </div>
                    <% }) %>
                <% } else { %>
                    <div style="text-align: center; color: var(--text-secondary); margin-top: 2rem;">
                        <p>Inicie a conversa com seu treinador.</p>
                    </div>
                <% } %>
            </div>

            <form id="chat-form" action="/chat/send" method="POST" class="chat-input-area">
                <input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
                <input type="text" name="message" class="input-modern" placeholder="Digite sua mensagem..." required style="margin: 0; border-radius: 20px;">
                <button type="submit" class="btn btn-primary" style="border-radius: 50%; width: 45px; height: 45px; padding: 0;">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </form>
        </div>
    </main>
</div>
<script>
    // Rolar para o fim do chat ao carregar
    const chatBox = document.getElementById('chat-messages');
    if(chatBox) chatBox.scrollTop = chatBox.scrollHeight;
</script>
<%- include('../partials/footer.ejs') %>
