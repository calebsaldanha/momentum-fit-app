<%- include('../partials/header.ejs') %>
<div class="dashboard-container">
    <%- include('../partials/sidebar.ejs', { path: '/client/profile' }) %>
    <main class="dashboard-main">
        <div class="mobile-dash-header">
            <button id="sidebarOpenBtn" class="btn btn-outline btn-sm"><i class="fas fa-bars"></i></button>
            <span>Perfil</span>
        </div>

        <div class="page-header">
            <h1>Ficha do <span class="text-neon">Aluno</span></h1>
            <p>Mantenha seus dados atualizados para que seu treinador possa personalizar seu plano.</p>
        </div>

        <% if(messages.success) { %><div class="alert alert-success"><%= messages.success %></div><% } %>
        <% if(messages.error) { %><div class="alert alert-danger"><%= messages.error %></div><% } %>

        <form action="/client/profile" method="POST">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">

            <div style="display: grid; gap: 30px; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
                
                <div class="card-box">
                    <h3 style="color: white; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;">Dados Pessoais</h3>
                    <div style="margin-bottom: 15px;">
                        <label style="color: #888;">Nome Completo</label>
                        <input type="text" name="name" value="<%= client.name %>" class="form-control" style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white;">
                    </div>
                    <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <label style="color: #888;">Telefone/Zap</label>
                            <input type="text" name="phone" value="<%= client.phone || '' %>" class="form-control" placeholder="(00) 90000-0000" style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white;">
                        </div>
                        <div style="flex: 1;">
                            <label style="color: #888;">Data Nascimento</label>
                            <input type="date" name="birth_date" value="<%= client.birth_date ? new Date(client.birth_date).toISOString().split('T')[0] : '' %>" style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white;">
                        </div>
                    </div>
                </div>

                <div class="card-box">
                    <h3 style="color: white; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;">Objetivos</h3>
                    <div style="display: flex; gap: 15px; margin-bottom: 15px;">
                        <div style="flex: 1;">
                            <label style="color: #888;">Peso (kg)</label>
                            <input type="number" step="0.1" name="weight" value="<%= client.weight %>" style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white;">
                        </div>
                        <div style="flex: 1;">
                            <label style="color: #888;">Altura (cm)</label>
                            <input type="number" name="height" value="<%= client.height %>" style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white;">
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="color: #888;">Objetivo Principal</label>
                        <select name="goal" style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white;">
                            <option value="emagrecimento" <%= client.goal === 'emagrecimento' ? 'selected' : '' %>>Emagrecimento</option>
                            <option value="hipertrofia" <%= client.goal === 'hipertrofia' ? 'selected' : '' %>>Hipertrofia (Ganhar Massa)</option>
                            <option value="saude" <%= client.goal === 'saude' ? 'selected' : '' %>>Saúde e Bem-estar</option>
                            <option value="performance" <%= client.goal === 'performance' ? 'selected' : '' %>>Performance Atlética</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="color: #888;">Detalhe seu objetivo (Opcional)</label>
                        <textarea name="goal_description" rows="2" style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white;"><%= client.goal_description || '' %></textarea>
                    </div>
                </div>

                <div class="card-box">
                    <h3 style="color: white; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;">Rotina</h3>
                    <div style="margin-bottom: 15px;">
                        <label style="color: #888;">Nível de Atividade</label>
                        <select name="activity_level" style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white;">
                            <option value="sedentario" <%= client.activity_level === 'sedentario' ? 'selected' : '' %>>Sedentário (Pouco movimento)</option>
                            <option value="leve" <%= client.activity_level === 'leve' ? 'selected' : '' %>>Leve (Exercício 1-3x/semana)</option>
                            <option value="moderado" <%= client.activity_level === 'moderado' ? 'selected' : '' %>>Moderado (Exercício 3-5x/semana)</option>
                            <option value="intenso" <%= client.activity_level === 'intenso' ? 'selected' : '' %>>Intenso (Exercício 6-7x/semana)</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="color: #888;">Equipamentos Disponíveis</label>
                        <input type="text" name="available_equipment" value="<%= client.available_equipment || '' %>" placeholder="Ex: Academia completa, Halteres em casa..." style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white;">
                    </div>
                </div>

                <div class="card-box">
                    <h3 style="color: #ff4d4d; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;">Saúde & Anamnese</h3>
                    <div style="margin-bottom: 15px;">
                        <label style="color: #888;">Histórico Médico (Doenças cardíacas, diabetes, etc)</label>
                        <textarea name="medical_history" rows="2" style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white;"><%= client.medical_history || '' %></textarea>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="color: #888;">Medicamentos em uso</label>
                        <textarea name="medications" rows="2" style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white;"><%= client.medications || '' %></textarea>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="color: #888;">Lesões (Joelho, Ombro, Costas...)</label>
                        <textarea name="injuries" rows="2" style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white;"><%= client.injuries || '' %></textarea>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="color: #888;">Outras Limitações</label>
                        <input type="text" name="limitations" value="<%= client.limitations || '' %>" placeholder="Ex: Não posso pular, dor no pulso..." style="width: 100%; padding: 10px; background: #222; border: 1px solid #444; color: white;">
                    </div>
                </div>

                <div style="grid-column: 1 / -1; text-align: right;">
                    <button class="btn btn-primary btn-lg" style="width: 100%;">Salvar Ficha Completa</button>
                </div>
            </div>
        </form>
            
        <div class="card-box" style="margin-top: 40px; border: 1px solid var(--primary-color);">
            <h3 style="color: var(--primary-color);">Renovação de Plano</h3>
            <div style="display: flex; gap: 30px; align-items: center; flex-wrap: wrap;">
                <div>
                    <p style="color: white; font-size: 1.2rem;">Plano: <strong><%= subscription.plan %></strong></p>
                    <p style="color: white;">Valor: <strong>R$ <%= subscription.price %></strong></p>
                    <p class="text-muted">Chave PIX: <%= subscription.pixKey %></p>
                </div>
                <div style="background: white; padding: 10px; border-radius: 8px;">
                    <img src="<%= subscription.qrCode %>" alt="QR Code" width="120">
                </div>
            </div>
        </div>

    </main>
</div>
<%- include('../partials/footer.ejs') %>
