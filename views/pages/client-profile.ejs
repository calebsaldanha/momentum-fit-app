<%- include('../partials/header', { title: 'Meu Perfil', bodyClass: 'dashboard-body' }) %>
<div class="dashboard-container">
    <%- include('../partials/sidebar.ejs', { currentPage: 'profile' }) %>
    
    <main class="dashboard-main">
        <div class="section">
            <div class="section-header">
                <h1>Meu Perfil</h1>
            </div>

            <script>
                const params = new URLSearchParams(window.location.search);
                if (params.get('error')) alert('Erro: ' + params.get('error'));
                if (params.get('success')) alert('Sucesso: ' + params.get('success'));
            </script>

            <div class="profile-card">
                <div class="profile-header-large">
                    <div class="profile-avatar-xl">
                        <% if (user.profile_image) { %>
                            <img src="<%= user.profile_image %>" alt="Perfil">
                        <% } else { %>
                            <i class="fas fa-user"></i>
                        <% } %>
                    </div>
                    <h2><%= user.name %></h2>
                    <span class="badge"><%= user.role === 'client' ? 'Aluno' : 'Treinador' %></span>
                </div>

                <div class="profile-details-grid">
                    <div class="detail-item">
                        <label>Email</label>
                        <p><%= user.email %></p>
                    </div>
                    <div class="detail-item">
                        <label>Data de Cadastro</label>
                        <p><%= new Date(user.created_at).toLocaleDateString('pt-BR') %></p>
                    </div>
                    <div class="detail-item">
                        <label>Objetivo</label>
                        <p><%= user.goal || 'Não definido' %></p>
                    </div>
                </div>

                <hr style="margin: 2rem 0; border: 0; border-top: 1px solid #eee;">

                <h3>Segurança</h3>
                <form action="/client/change-password" method="POST" style="max-width: 400px; margin-top: 1rem;">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    
                    <div class="form-group">
                        <label>Senha Atual</label>
                        <input type="password" name="current_password" required class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>Nova Senha</label>
                        <input type="password" name="new_password" required class="form-control">
                    </div>

                    <div class="form-group">
                        <label>Confirmar Nova Senha</label>
                        <input type="password" name="confirm_password" required class="form-control">
                    </div>

                    <button type="submit" class="btn btn-primary">Alterar Senha</button>
                </form>
            </div>
        </div>
    </main>
</div>
<%- include('../partials/footer') %>
