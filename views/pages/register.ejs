<%- include('../partials/header.ejs', { title: 'Criar Conta' }) %>

<% 
    // Lógica para detectar se é cadastro de Personal Trainer
    let isTrainer = false;
    let isFreePlan = false;
    
    if (typeof query !== 'undefined') {
        if (query.role === 'trainer') isTrainer = true;
        if (query.plan === 'free') isFreePlan = true;
    }
%>

<main class="auth-wrapper">
    <div class="auth-visual" style="background-image: url('<%= isTrainer ? '/images/hero-bg.png' : '/images/features-bg.png' %>');">
        <div class="auth-quote">
            <% if (isTrainer) { %>
                <h2>Potencialize sua carreira.</h2>
                <p>Ferramentas de gestão de alunos, biblioteca de exercícios e IA ao seu favor. Aumente sua receita.</p>
            <% } else { %>
                <h2>Seu corpo, sua máquina.</h2>
                <p>Junte-se a milhares de usuários que estão transformando dados em performance física.</p>
            <% } %>
        </div>
    </div>

    <div class="auth-form-container">
        <div class="auth-header">
            <h1 style="color: white; margin-bottom: 10px;">
                <%= isTrainer ? 'Cadastro de Personal' : 'Crie sua conta' %>
            </h1>
            <p>
                <%= isTrainer ? 'Junte-se ao time de especialistas.' : 'Comece sua jornada de transformação hoje.' %>
            </p>
        </div>

        <% if (messages.error && messages.error.length > 0) { %>
            <div style="background: rgba(255, 77, 77, 0.1); color: #ff6b6b; padding: 12px; border-radius: 6px; margin-bottom: 20px; font-size: 0.9rem; border: 1px solid rgba(255,77,77,0.2);">
                <i class="fas fa-exclamation-circle"></i> <%= messages.error %>
            </div>
        <% } %>

        <form action="/auth/register" method="POST">
            <input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
            
            <input type="hidden" name="role" value="<%= isTrainer ? 'trainer' : 'client' %>">

            <div class="form-group">
                <label class="form-label">Nome Completo</label>
                <input type="text" name="name" class="form-control" placeholder="Ex: João Silva" required>
            </div>

            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" name="email" class="form-control" placeholder="seu@email.com" required>
            </div>

            <div class="form-group">
                <label class="form-label">Senha</label>
                <input type="password" name="password" class="form-control" placeholder="Mínimo 6 caracteres" required minlength="6">
            </div>

            <div class="form-group">
                <label class="form-label">Confirmar Senha</label>
                <input type="password" name="confirmPassword" class="form-control" placeholder="Repita a senha" required>
            </div>

            <div class="form-group" style="display: flex; gap: 10px; align-items: flex-start;">
                <input type="checkbox" required style="margin-top: 4px; accent-color: var(--primary-color);">
                <span style="font-size: 0.85rem; color: #888;">
                    Li e concordo com os <a href="/terms" target="_blank">Termos de Uso</a> e <a href="/privacy" target="_blank">Política de Privacidade</a>.
                </span>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%;">
                <%= isTrainer ? 'Cadastrar como Treinador' : 'Criar Conta Grátis' %>
            </button>
        </form>

        <div class="auth-footer">
            Já tem conta? <a href="/auth/login">Fazer Login</a>
            <br><br>
            
            <% if (!isTrainer) { %>
                <a href="/auth/register?role=trainer" style="font-size: 0.8rem; color: #444; text-decoration: underline;">
                    Sou Personal Trainer
                </a>
            <% } else { %>
                <a href="/auth/register" style="font-size: 0.8rem; color: #444; text-decoration: underline;">
                    Quero treinar (Sou Aluno)
                </a>
            <% } %>
        </div>
    </div>
</main>

<%- include('../partials/footer.ejs') %>
