<%- include('../partials/header.ejs', { title: 'Detalhes do Treino', bodyClass: 'dashboard-body' }) %>

<style>
    /* Estilos para o Modal de Imagem */
    .image-modal {
        display: none; 
        position: fixed; 
        z-index: 1000; 
        padding-top: 50px; 
        left: 0;
        top: 0;
        width: 100%; 
        height: 100%; 
        overflow: auto; 
        background-color: rgba(0,0,0,0.9); 
        backdrop-filter: blur(5px);
    }
    .modal-content {
        margin: auto;
        display: block;
        width: 80%;
        max-width: 900px;
        max-height: 80vh;
        object-fit: contain;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
        animation: zoomIn 0.3s;
    }
    .close-modal {
        position: absolute;
        top: 20px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        transition: 0.3s;
        cursor: pointer;
        z-index: 1001;
    }
    .close-modal:hover,
    .close-modal:focus {
        color: var(--c-accent-primary);
        text-decoration: none;
        cursor: pointer;
    }
    @keyframes zoomIn {
        from {transform:scale(0)} 
        to {transform:scale(1)}
    }
    /* Cursor de zoom na imagem */
    .zoomable-image {
        cursor: zoom-in;
        transition: transform 0.2s;
    }
    .zoomable-image:hover {
        transform: scale(1.02);
    }
</style>

<div class="dashboard-container">
    <% if (typeof user !== 'undefined' && (user.role === 'trainer' || user.role === 'superadmin')) { %>
        <%- include('../partials/sidebar.ejs', { currentPage: 'workouts' }) %>
    <% } else { %>
        <% if (typeof profile === 'undefined') { var profile = {}; } %>
        <%- include('../partials/sidebar.ejs', { currentPage: 'workouts' }) %>
    <% } %>

    <main class="dashboard-main">
        <div class="section">
            <div class="section-header" style="flex-direction: column; align-items: flex-start;">
                <div style="display:flex; justify-content:space-between; width:100%; align-items:center;">
                    <h1><%= workout.title %></h1>
                    <a href="javascript:history.back()" class="btn btn-outline btn-sm">
                        <i class="fas fa-arrow-left"></i> Voltar
                    </a>
                </div>
                <% if(workout.description) { %>
                    <p style="margin-top:0.5rem; opacity:0.8; display: flex; align-items: center;">
                        <i class="fas fa-info-circle" style="margin-right: 8px;"></i> <%= workout.description %>
                    </p>
                <% } %>
            </div>

            <div class="exercises-list">
                <% if (exercises.length === 0) { %>
                    <div style="padding: 2rem; text-align: center; color: #888;">
                        <i class="far fa-folder-open" style="font-size: 2rem; margin-bottom: 10px;"></i><br>
                        Nenhum exercício cadastrado neste treino.
                    </div>
                <% } %>

                <% exercises.forEach((ex, index) => { %>
                    <div class="card exercise-card" style="margin-bottom: 2rem; overflow: hidden; border: 1px solid var(--c-border);">
                        <div class="card-body" style="padding: 1.5rem;">
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--c-border); padding-bottom: 1rem; margin-bottom: 1rem;">
                                <h3 style="margin:0; color: var(--c-accent-primary); font-size: 1.3rem;"><%= index + 1 %>. <%= ex.name %></h3>
                                <span class="badge" style="background: var(--c-bg-main); font-size: 1.1rem; padding: 0.5rem 1rem;">
                                    <i class="fas fa-layer-group"></i> <%= ex.sets %> x <%= ex.reps %>
                                </span>
                            </div>

                            <div class="exercise-grid" style="display: grid; grid-template-columns: 1fr 300px; gap: 2rem;">
                                <div>
                                    <% if (ex.notes) { %>
                                        <div style="margin-bottom: 1.5rem; background: var(--c-bg-main); padding: 1rem; border-radius: var(--radius);">
                                            <strong style="display: flex; align-items: center; gap: 8px;">
                                                <i class="fas fa-edit" style="color: var(--c-accent-primary);"></i> Nota do Personal:
                                            </strong>
                                            <p style="margin: 0.5rem 0 0; padding-left: 24px;"><%= ex.notes %></p>
                                        </div>
                                    <% } %>

                                    <% if (ex.execution_instructions) { %>
                                        <div style="margin-bottom: 1rem;">
                                            <strong style="color: var(--c-text-primary); display: flex; align-items: center; gap: 8px;">
                                                <i class="fas fa-map-marker-alt" style="color: var(--c-success);"></i> Execução:
                                            </strong>
                                            <p style="font-size: 0.95rem; line-height: 1.6; padding-left: 24px;"><%= ex.execution_instructions %></p>
                                        </div>
                                    <% } %>
                                    
                                    <% if (ex.tips) { %>
                                        <div style="margin-bottom: 1rem;">
                                            <strong style="color: var(--c-text-primary); display: flex; align-items: center; gap: 8px;">
                                                <i class="far fa-lightbulb" style="color: #eab308;"></i> Dica Pro:
                                            </strong>
                                            <p style="font-size: 0.95rem; color: var(--c-text-secondary); padding-left: 24px;"><%= ex.tips %></p>
                                        </div>
                                    <% } %>

                                    <% if (ex.video_url) { %>
                                        <a href="<%= ex.video_url %>" target="_blank" class="btn btn-sm btn-outline" style="margin-top: 1rem; display: inline-flex; align-items: center; gap: 8px;">
                                            <i class="fab fa-youtube" style="color: #ff0000;"></i> Assistir Vídeo Externo
                                        </a>
                                    <% } %>
                                </div>

                                <div>
                                    <% if (ex.image_url) { %>
                                        <div style="border-radius: var(--radius); overflow: hidden; box-shadow: var(--shadow-sm); border: 1px solid var(--c-border);">
                                            <img src="<%= ex.image_url %>" alt="<%= ex.name %>" 
                                                 class="zoomable-image"
                                                 onclick="openModal(this.src)"
                                                 style="width: 100%; height: auto; object-fit: cover; display: block;">
                                            <small style="display:block; text-align:center; color:#666; padding:5px; font-size:0.7rem;">
                                                <i class="fas fa-search-plus"></i> Clique para ampliar
                                            </small>
                                        </div>
                                    <% } else { %>
                                        <div style="height: 200px; background: var(--c-bg-main); display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--c-text-secondary); border-radius: var(--radius); border: 1px solid var(--c-border);">
                                            <i class="fas fa-dumbbell" style="font-size: 3rem; opacity: 0.3; margin-bottom: 10px;"></i>
                                            <p style="font-size: 0.8rem;">Sem imagem</p>
                                        </div>
                                    <% } %>
                                </div>
                            </div>
                            <style>
                                @media (max-width: 768px) {
                                    .exercise-grid { grid-template-columns: 1fr !important; }
                                    .exercise-grid img { max-height: 250px; width: 100%; object-fit: contain; margin-top: 1rem; }
                                }
                            </style>
                        </div>
                    </div>
                <% }); %>
            </div>
        </div>
    </main>
</div>

<div id="imageModal" class="image-modal" onclick="closeModal()">
  <span class="close-modal">&times;</span>
  <img class="modal-content" id="img01">
</div>

<script>
    function openModal(src) {
        var modal = document.getElementById("imageModal");
        var modalImg = document.getElementById("img01");
        modal.style.display = "flex";
        modal.style.alignItems = "center";
        modal.style.justifyContent = "center";
        modalImg.src = src;
    }

    function closeModal() {
        var modal = document.getElementById("imageModal");
        modal.style.display = "none";
    }

    // Fecha com ESC
    document.addEventListener('keydown', function(event) {
        if (event.key === "Escape") {
            closeModal();
        }
    });
</script>

<%- include('../partials/footer.ejs') %>
