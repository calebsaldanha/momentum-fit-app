<%- include('../partials/header.ejs', { title: 'Avaliação Inicial', currentPage: 'initial-form' }) %>

<div class="dashboard-container" style="justify-content: center; background: var(--bg-app);">
    
    <div class="dashboard-main" style="margin-left: 0; width: 100%; max-width: 900px;">
        <div class="text-center" style="margin-bottom: 3rem;">
            <h1 class="text-neon" style="font-size: 2.5rem;">Ficha de Anamnese</h1>
            <p class="text-muted">Precisamos conhecer você para criar o plano perfeito.</p>
        </div>

        <% if (typeof error !== 'undefined' && error && error.length > 0) { %>
            <div class="alert alert-error"><%= error %></div>
        <% } %>

        <form action="/client/initial-form" method="POST">
            <input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">

            <div class="card-modern">
                <h3 class="text-neon">1. Sobre Você</h3>
                <div class="grid-cols-2">
                    <div class="form-group"><label class="form-label">Idade</label><input type="number" name="age" class="input-modern" required value="<%= profile?.age || '' %>"></div>
                    <div class="form-group"><label class="form-label">Celular (WhatsApp)</label><input type="text" name="phone" class="input-modern" required value="<%= profile?.phone || '' %>"></div>
                    <div class="form-group">
                        <label class="form-label">Sexo Biológico</label>
                        <select name="sex_assigned_at_birth" class="select-modern" required>
                            <option value="">Selecione...</option>
                            <option value="M" <%= profile?.sex_assigned_at_birth === 'M' ? 'selected' : '' %>>Masculino</option>
                            <option value="F" <%= profile?.sex_assigned_at_birth === 'F' ? 'selected' : '' %>>Feminino</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Uso de Hormônios?</label>
                        <select name="hormonal_treatment" class="select-modern">
                            <option value="false">Não</option>
                            <option value="true" <%= profile?.hormonal_treatment === true ? 'selected' : '' %>>Sim</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="card-modern">
                <h3 class="text-neon">2. Medidas Atuais</h3>
                <div class="grid-cols-3">
                    <div class="form-group"><label class="form-label">Peso (kg)</label><input type="number" step="0.1" name="weight" class="input-modern" required value="<%= profile?.current_weight || profile?.weight || '' %>"></div>
                    <div class="form-group"><label class="form-label">Altura (m)</label><input type="number" step="0.01" name="height" class="input-modern" required value="<%= profile?.height || '' %>"></div>
                    <div class="form-group"><label class="form-label">Cintura (cm)</label><input type="number" name="measure_waist" class="input-modern" value="<%= profile?.measure_waist || '' %>"></div>
                </div>
            </div>

            <div class="card-modern">
                <h3 class="text-neon">3. Treino & Objetivos</h3>
                <div class="form-group">
                    <label class="form-label">Objetivo Principal *</label>
                    <input type="text" name="main_goal" class="input-modern" required placeholder="Ex: Hipertrofia, Emagrecimento, Resistência" value="<%= profile?.fitness_goals || profile?.main_goal || '' %>">
                </div>
                
                <div class="grid-cols-2">
                    <div class="form-group">
                        <label class="form-label">Nível de Experiência</label>
                        <select name="fitness_level" class="select-modern" required>
                            <option value="beginner" <%= profile?.fitness_level === 'beginner' ? 'selected' : '' %>>Iniciante</option>
                            <option value="intermediate" <%= profile?.fitness_level === 'intermediate' ? 'selected' : '' %>>Intermediário</option>
                            <option value="advanced" <%= profile?.fitness_level === 'advanced' ? 'selected' : '' %>>Avançado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Frequência Semanal (Dias)</label>
                        <select name="training_days" class="select-modern" required>
                            <option value="3" <%= profile?.training_days_frequency == 3 ? 'selected' : '' %>>3 dias</option>
                            <option value="4" <%= profile?.training_days_frequency == 4 ? 'selected' : '' %>>4 dias</option>
                            <option value="5" <%= profile?.training_days_frequency == 5 ? 'selected' : '' %>>5 dias</option>
                            <option value="6" <%= profile?.training_days_frequency == 6 ? 'selected' : '' %>>6 dias</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Lesões ou Dores?</label>
                    <textarea name="injuries" class="textarea-modern" rows="2" placeholder="Descreva qualquer lesão ou dor crônica..."><%= profile?.injuries || '' %></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Equipamentos Disponíveis</label>
                    <input type="text" name="equipment" class="input-modern" placeholder="Academia completa, Halteres em casa, etc..." value="<%= profile?.equipment || '' %>">
                </div>
            </div>

            <button type="submit" class="btn btn-primary btn-full btn-lg" style="margin-bottom: 3rem;">
                FINALIZAR AVALIAÇÃO
            </button>
        </form>
    </div>
</div>
<%- include('../partials/footer.ejs') %>
