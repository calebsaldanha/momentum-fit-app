<%- include('../partials/header.ejs', { title, bodyClass: 'dashboard-body' }) %>

<div class="dashboard-container">
    <aside class="dashboard-sidebar">
        <nav class="sidebar-nav">
            <% if (user.role === 'superadmin') { %>
                <a href="/superadmin/dashboard" class="nav-item" style="color: var(--c-accent-dark); background: #eaff0040; border-left-color: var(--c-accent-primary);">
                    <span><img src="/images/momentum-fit-icon.png" class="icon-sm"></span> Voltar Super Admin
                </a>
                <div style="height: 1px; background: #e2e8f0; margin: 0.5rem 1rem;"></div>
            <% } %>
            <a href="/admin/dashboard" class="nav-item">
                <span><img src="/images/momentum-fit-icon.png" class="icon-sm"></span> Dashboard
            </a>
            <a href="/admin/clients" class="nav-item active">
                <span><img src="/images/momentum-fit-icon.png" class="icon-sm"></span> Clientes
            </a>
            <a href="/workouts/create" class="nav-item">
                <span><img src="/images/momentum-fit-icon.png" class="icon-sm"></span> Criar Treino
            </a>
            <a href="/chat" class="nav-item">
                <span><img src="/images/momentum-fit-icon.png" class="icon-sm"></span> Chat
            </a>
        </nav>
        <div class="sidebar-footer">
            <form action="/auth/logout" method="POST" style="margin: 0;">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <button type="submit" class="btn-logout-sidebar">Sair</button>
            </form>
        </div>
    </aside>

    <main class="dashboard-main">
        <div class="section">
            <div class="section-header section-header-inline">
                <div>
                    <h1><%= clientProfile.name %></h1>
                    <p>Email: <%= clientProfile.email %></p>
                </div>
                <a href="/workouts/create?clientId=<%= clientProfile.id %>" class="btn btn-primary">Criar Novo Treino</a>
            </div>

            <% if (user.role === 'superadmin') { %>
            <div class="info-card" style="background-color: var(--c-dashboard-bg); padding: 1rem; border-radius: var(--radius); margin-bottom: 2rem;">
                <form method="POST" action="/admin/clients/<%= clientProfile.id %>/assign" style="display: flex; align-items: center; gap: 1rem; justify-content: space-between;">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <div>
                        <label for="trainer_id" style="font-weight: 600; display: block; margin-bottom: 0.5rem;">Atribuir a um Personal</label>
                        <select name="trainer_id" id="trainer_id" style="padding: 0.5rem; border-radius: var(--radius); border: 1px solid var(--c-border);">
                            <option value="">Selecione um personal</option>
                            <% allTrainers.forEach(trainer => { %>
                                <option value="<%= trainer.id %>" <%= clientProfile.assigned_trainer_id == trainer.id ? 'selected' : '' %>>
                                    <%= trainer.name %>
                                </option>
                            <% }); %>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary btn-sm" style="align-self: flex-end;">Salvar</button>
                </form>
            </div>
            <% } %>
            
            <div class="client-info-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                <div class="info-card">
                    <h4>Informações Básicas</h4>
                    <p><strong>Idade:</strong> <%= clientProfile.age || 'Não informado' %></p>
                    <p><strong>Nível:</strong> <%= clientProfile.fitness_level || 'Não informado' %></p>
                </div>
                <div class="info-card">
                    <h4>Saúde e Limitações</h4>
                    <p><strong>Condições Médicas:</strong> <%= clientProfile.medical_conditions || 'Nenhuma' %></p>
                    <p><strong>Peso / Altura:</strong> <%= clientProfile.weight || 'N/A' %> kg / <%= clientProfile.height || 'N/A' %> cm</p>
                </div>
                <div class="info-card" style="grid-column: 1 / -1;">
                     <h4>Objetivos</h4>
                    <p><%= clientProfile.goals || 'Nenhum objetivo principal informado.' %></p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Treinos de <%= clientProfile.name %></h2>
             <% if (workouts && workouts.length > 0) { %>
                <div class="workouts-grid">
                    <% workouts.forEach(workout => { %>
                        <div class="workout-card">
                             <div class="card-content">
                                <h3><%= workout.title %></h3>
                                <div class="workout-meta">
                                    <span>Por: <%= workout.trainer_name || 'Personal não definido' %></span>
                                    <span>Criado em: <%= new Date(workout.created_at).toLocaleDateString('pt-BR') %></span>
                                </div>
                                <p>Check-ins: <%= workout.completed_checkins %> / <%= workout.total_checkins %></p>
                            </div>
                             <div class="card-footer">
                                <a href="/workouts/<%= workout.id %>" class="btn btn-primary btn-sm">Ver Detalhes</a>
                            </div>
                         </div>
                    <% }); %>
                </div>
            <% } else { %>
                <div class="empty-state" style="padding: 2rem 0;">
                    <p><%= clientProfile.name %> ainda não tem treinos. <a href="/workouts/create?clientId=<%= clientProfile.id %>">Crie o primeiro!</a></p>
                </div>
            <% } %>
        </div>
    </main>
</div>
<%- include('../partials/footer.ejs') %>
