<%- include('../partials/header.ejs', { title, bodyClass: 'dashboard-body' }) %>
<div class="dashboard-container">
    <%- include('../partials/admin-sidebar.ejs') %>
    <main class="dashboard-main">
        <section class="section">
            <div class="section-header">
                <div>
                    <h1><%= clientProfile.name %></h1>
                    <p><%= clientProfile.email %></p>
                </div>
                <a href="/admin/clients" class="btn btn-secondary">Voltar</a>
            </div>

            <div style="background: var(--c-bg-card); padding: 1.5rem; border-radius: var(--radius); border: 1px solid var(--c-border); margin-bottom: 2rem;">
                <h4 style="color: var(--c-accent-primary); margin-bottom: 1rem;">Personal Trainer Responsável</h4>
                <form action="/admin/clients/<%= clientProfile.user_id %>/assign" method="POST" style="display: flex; gap: 1rem; align-items: flex-end;">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <div class="form-group" style="flex: 1; margin: 0;">
                        <label>Selecione o Treinador</label>
                        <select name="trainer_id" style="margin: 0;">
                            <option value="">-- Sem Personal Definido --</option>
                            <% allTrainers.forEach(trainer => { %>
                                <option value="<%= trainer.id %>" <%= clientProfile.assigned_trainer_id === trainer.id ? 'selected' : '' %>>
                                    <%= trainer.name %>
                                </option>
                            <% }); %>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">Salvar Atribuição</button>
                </form>
            </div>

            <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 2rem;">
                <div class="stat-card">
                    <h3><%= clientProfile.age || '-' %></h3>
                    <p>Idade</p>
                </div>
                <div class="stat-card">
                    <h3><%= clientProfile.weight ? clientProfile.weight + 'kg' : '-' %></h3>
                    <p>Peso</p>
                </div>
                <div class="stat-card">
                    <h3><%= clientProfile.height ? clientProfile.height + 'm' : '-' %></h3>
                    <p>Altura</p>
                </div>
                <div class="stat-card">
                    <h3><%= clientProfile.fitness_level === 'beginner' ? 'Iniciante' : clientProfile.fitness_level === 'intermediate' ? 'Intermediário' : 'Avançado' %></h3>
                    <p>Nível</p>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;">
                 <div style="background: var(--c-bg-card); padding: 1.5rem; border-radius: var(--radius); border: 1px solid var(--c-border);">
                    <h4 style="margin-bottom: 0.5rem; color: var(--c-text-secondary);">Objetivos</h4>
                    <p><%= clientProfile.goals || 'Não informado' %></p>
                </div>
                <div style="background: var(--c-bg-card); padding: 1.5rem; border-radius: var(--radius); border: 1px solid var(--c-border);">
                    <h4 style="margin-bottom: 0.5rem; color: var(--c-text-secondary);">Condições Médicas</h4>
                    <p><%= clientProfile.medical_conditions || 'Nenhuma' %></p>
                </div>
            </div>

            <div class="section-header" style="margin-top: 3rem;">
                <h2>Planos de Treino</h2>
                <a href="/workouts/create?clientId=<%= clientProfile.user_id %>" class="btn btn-primary">+ Novo Treino</a>
            </div>

            <% if (workouts && workouts.length > 0) { %>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Criado em</th>
                                <th>Personal</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% workouts.forEach(workout => { %>
                                <tr>
                                    <td><strong><%= workout.title %></strong></td>
                                    <td><%= new Date(workout.created_at).toLocaleDateString() %></td>
                                    <td><%= workout.trainer_name || 'Sistema' %></td>
                                    <td>
                                        <div style="display: flex; gap: 0.5rem;">
                                            <a href="/workouts/<%= workout.id %>" class="btn btn-sm btn-secondary">Ver</a>
                                            <a href="/workouts/edit/<%= workout.id %>" class="btn btn-sm btn-outline">Editar</a>
                                            <form action="/workouts/delete/<%= workout.id %>" method="POST" onsubmit="return confirm('Tem certeza que deseja excluir este treino?');">
                                                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                                <button type="submit" class="btn btn-sm btn-outline" style="border-color: var(--c-error); color: var(--c-error);">Excluir</button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            <% } else { %>
                <div class="empty-state">
                    <p>Este cliente ainda não possui treinos cadastrados.</p>
                </div>
            <% } %>

        </section>
    </main>
</div>
<%- include('../partials/footer.ejs') %>
