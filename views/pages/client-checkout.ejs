<%- include('../partials/header') %>
<div class="dashboard-container">
    <%- include('../partials/sidebar') %>
    
    <main class="main-content">
        <div class="page-header">
            <h1>Finalizar Assinatura</h1>
            <p>Plano Selecionado: <strong><%= plan.name %></strong></p>
        </div>

        <div class="checkout-grid">
            <div class="card plan-summary">
                <h3>Resumo</h3>
                <div class="price-tag">R$ <%= plan.price %> <span class="period">/mês</span></div>
                <ul class="features-list">
                    <% if (plan.features && plan.features.length) { %>
                        <% plan.features.forEach(f => { %>
                            <li>✅ <%= f %></li>
                        <% }) %>
                    <% } else { %>
                        <li>✅ Acesso a treinos</li>
                        <li>✅ Chat com IA</li>
                    <% } %>
                </ul>
            </div>

            <div class="card payment-details">
                <h3>Pagamento via PIX</h3>
                <p>Escaneie o QR Code ou use a chave abaixo para realizar o pagamento.</p>
                
                <div style="text-align: center; margin: 20px 0;">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=<%= pixKey %>" alt="QR Code Pix" style="border: 2px solid #eee; padding: 10px; border-radius: 8px;">
                </div>

                <div class="form-group">
                    <label>Chave Pix (Copia e Cola):</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" value="<%= pixKey %>" id="pixKeyInput" readonly class="form-control">
                        <button type="button" onclick="copyPix()" class="btn-secondary">Copiar</button>
                    </div>
                </div>

                <hr>

                <form action="/client/checkout" method="POST" enctype="application/x-www-form-urlencoded">
                    <input type="hidden" name="plan_id" value="<%= plan.id %>">
                    
                    <div class="form-group">
                        <label>Melhor dia para vencimento:</label>
                        <select name="due_day" required>
                            <option value="5">Dia 05</option>
                            <option value="10">Dia 10</option>
                            <option value="15">Dia 15</option>
                            <option value="20">Dia 20</option>
                        </select>
                    </div>

                    <div class="alert alert-info">
                        Após pagar, clique em "Confirmar Pagamento". Seu plano será ativado após conferência.
                    </div>

                    <button type="submit" class="btn-primary btn-block">Confirmar Pagamento Enviado</button>
                </form>
            </div>
        </div>
    </main>
</div>

<script>
    function copyPix() {
        var copyText = document.getElementById("pixKeyInput");
        copyText.select();
        copyText.setSelectionRange(0, 99999); 
        navigator.clipboard.writeText(copyText.value);
        alert("Chave Pix copiada: " + copyText.value);
    }
</script>
<%- include('../partials/footer') %>
